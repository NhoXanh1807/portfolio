---
import type { MarkdownInstance } from "astro";
import BaseHead from "../../components/BaseHead.astro";
import Footer from "../../components/Footer.astro";
import Header from "../../components/Header.astro";
import { SITE_DESCRIPTION, SITE_TITLE } from "../../consts";

const modules = import.meta.glob<MarkdownInstance<any>>("../../content/writeups/*.md", { eager: true });
const writeups = Object.entries(modules)
  .map(([path, mod]) => {
    const slug = path.split("/").pop()?.replace(/\.md$/, "");
    if (!slug) {
      return undefined;
    }

    const { frontmatter } = mod;
    const pubDate = new Date(frontmatter.pubDate);
    const updatedDate = frontmatter.updatedDate ? new Date(frontmatter.updatedDate) : undefined;

    return {
      slug,
      title: frontmatter.title,
      summary: frontmatter.summary,
      heroImage: frontmatter.heroImage,
      tags: frontmatter.tags ?? [],
      tools: frontmatter.tools ?? [],
      pubDate,
      updatedDate,
    };
  })
  .filter((entry): entry is NonNullable<typeof entry> => Boolean(entry))
  .sort((a, b) => b.pubDate.getTime() - a.pubDate.getTime());

const pageTitle = "Writeups | " + SITE_TITLE;
---

<!doctype html>
<html lang="en">
	<head>
		<BaseHead title={pageTitle} description={SITE_DESCRIPTION} />
	</head>
	<body>
		<Header />
                <main>
                        <header class="page-header">
                                <div class="page-heading">
                                        <span class="eyebrow">Investigation Library</span>
                                        <h1>Writeups</h1>
                                </div>
                                <p>
                                        Every investigation note is written in Markdown and lives inside <code>src/content/writeups</code>.
                                        Drop screenshots beneath <code>public/images/writeups/&lt;slug&gt;/</code> and reference them right
                                        inside the Markdown body.
                                </p>
                        </header>

                        <section class="grid">
                                {writeups.map((entry) => (
                                        <article class="card">
                                                <a class="card-link" href={`/writeups/${entry.slug}/`}>
                                                        <div class="card-sheen" aria-hidden="true"></div>
                                                        {entry.heroImage && (
                                                                <img class="hero" src={entry.heroImage} alt={entry.title} loading="lazy" />
                                                        )}
                                                        <div class="meta">
                                                                <div class="meta-top">
                                                                        <p class="posted">{entry.pubDate.toLocaleDateString()}</p>
                                                                        {entry.updatedDate && (
                                                                                <p class="updated">Updated {entry.updatedDate.toLocaleDateString()}</p>
                                                                        )}
                                                                </div>
                                                                <h2>{entry.title}</h2>
                                                                <p class="summary">{entry.summary}</p>
                                                                {entry.tools.length > 0 && (
                                                                        <ul class="tools" aria-label="Tooling">
                                                                                {entry.tools.map((tool) => (
                                                                                        <li>{tool}</li>
                                                                                ))}
                                                                        </ul>
                                                                )}
                                                                {entry.tags.length > 0 && (
                                                                        <ul class="tags" aria-label="Tags">
                                                                                {entry.tags.map((tag) => (
                                                                                        <li>{tag}</li>
                                                                                ))}
                                                                        </ul>
                                                                )}
                                                        </div>
                                                </a>
                                        </article>
                                ))}
                        </section>
                </main>
		<Footer />
	</body>
</html>

<style>
        main {
                max-width: min(1220px, 100%);
                margin: 0 auto;
                padding: 4rem 1.5rem 5.5rem;
        }
        .page-header {
                margin-bottom: 3.5rem;
                display: grid;
                gap: 1.25rem;
                background: rgba(255, 255, 255, 0.85);
                border-radius: 1.5rem;
                padding: 2.25rem clamp(1.5rem, 4vw, 2.5rem);
                box-shadow: 0 30px 60px rgba(15, 23, 42, 0.12);
                position: relative;
                overflow: hidden;
                isolation: isolate;
        }
        .page-header::before {
                content: "";
                position: absolute;
                inset: 0;
                background: linear-gradient(120deg, rgba(14, 165, 233, 0.16), rgba(16, 185, 129, 0.18));
                opacity: 0.7;
                z-index: -2;
                animation: headerRibbonDrift 22s ease-in-out infinite;
        }
        .page-header::after {
                content: "";
                position: absolute;
                inset: 0;
                background: rgba(255, 255, 255, 0.75);
                z-index: -1;
        }
        .page-header p {
                max-width: 70ch;
                margin: 0;
        }
        .page-heading {
                display: flex;
                flex-wrap: wrap;
                align-items: center;
                gap: 1rem;
        }
        .page-heading h1 {
                font-size: clamp(2.4rem, 4vw, 3rem);
                margin: 0;
        }
        .eyebrow {
                letter-spacing: 0.12em;
                text-transform: uppercase;
                font-size: 0.9rem;
                background: rgba(var(--accent), 0.2);
                color: rgb(var(--black));
                padding: 0.4rem 0.8rem;
                border-radius: 999px;
                font-weight: 700;
        }
        .grid {
                display: grid;
                gap: 2.5rem;
                grid-template-columns: repeat(auto-fit, minmax(340px, 1fr));
        }
        .card {
                background: rgba(255, 255, 255, 0.9);
                border-radius: 1.35rem;
                box-shadow: 0 30px 60px rgba(15, 23, 42, 0.14);
                overflow: hidden;
                transition: transform 0.35s ease, box-shadow 0.35s ease;
                position: relative;
                isolation: isolate;
        }
        .card-link {
                display: block;
                text-decoration: none;
                color: inherit;
                height: 100%;
                position: relative;
        }
        .card:hover {
                transform: translateY(-10px);
                box-shadow: 0 40px 70px rgba(15, 23, 42, 0.2);
        }
        .hero {
                width: 100%;
                height: auto;
                object-fit: cover;
                max-height: 220px;
        }
        .meta {
                padding: 1.85rem 1.75rem 1.75rem;
                color: rgb(var(--gray-dark));
                display: grid;
                gap: 1.1rem;
        }
        .posted {
                margin: 0;
                font-size: 0.9rem;
                letter-spacing: 0.08em;
                text-transform: uppercase;
                color: rgba(var(--gray), 0.8);
        }
        .updated {
                margin: 0;
                font-size: 0.9rem;
                color: rgba(var(--accent), 0.9);
                font-weight: 600;
        }
        .meta-top {
                display: flex;
                flex-wrap: wrap;
                justify-content: space-between;
                gap: 0.75rem;
                align-items: baseline;
        }
        .summary {
                margin: 0;
                color: rgba(var(--gray-dark), 0.9);
                line-height: 1.6;
        }
	.tools,
	.tags {
		margin: 0;
		padding: 0;
		list-style: none;
		display: flex;
		flex-wrap: wrap;
		gap: 0.5rem;
	}
	.tools li,
	.tags li {
		font-size: 0.85rem;
		padding: 0.35rem 0.75rem;
		border-radius: 999px;
		background: rgba(var(--accent), 0.12);
		color: var(--accent);
		font-weight: 600;
	}
        .tags li {
                background: rgba(var(--gray-light), 0.45);
                color: rgb(var(--gray-dark));
        }
        .card-sheen {
                position: absolute;
                inset: 0;
                background: linear-gradient(120deg, rgba(255, 255, 255, 0) 20%, rgba(255, 255, 255, 0.35) 50%, rgba(255, 255, 255, 0) 80%);
                transform: translateX(-100%);
                transition: transform 0.8s ease;
                z-index: 1;
        }
        .card:hover .card-sheen {
                transform: translateX(120%);
        }
        @keyframes headerRibbonDrift {
                0% {
                        transform: translate3d(-10px, -6px, 0) scale(1);
                }
                50% {
                        transform: translate3d(12px, 8px, 0) scale(1.02);
                }
                100% {
                        transform: translate3d(-10px, -6px, 0) scale(1);
                }
        }
        @media (max-width: 720px) {
                main {
                        padding: 3rem 1rem 4.5rem;
                }
                .page-header {
                        padding: 2rem 1.5rem;
                }
        }
</style>
